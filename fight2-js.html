<script>
var gameRunning = false;


// --------FIGHT CONTROLLER----------------------------------------------FIGHT CONTROLLER -----------
var fightController = (function() {
  
  var Attack = function(attackingChar, blockingChar, moveType, val){
    this.attackingChar = attackingChar;
    this.blockingChar  = blockingChar;
    this.moveType     = moveType;
    this.val          = val;
  };
  var Special = function(attackingChar, blockingChar, moveType, val){
    this.attackingChar = attackingChar;
    this.blockingChar  = blockingChar;
    this.moveType     = moveType;
    this.val          = val;
  };
  var Heal = function(attackingChar, blockingChar, moveType, val){
    this.attackingChar = attackingChar;
    this.blockingChar  = blockingChar;
    this.moveType     = moveType;
    this.val          = val;
  };

  var data = {
    name: {
      hero: "",
      boss: "Dwarf Deer"
    }, 
    
    email: {
      hero: "",
      boss: "shortybigrack@cleanendings.com"
    
    },
        
    battleLog: [],
    
    // number of heals available
    heal: {   
      hero: 0,
      boss: 0
    },
    
    // Hit points left
    hp: {
      hero: 10,
      boss: 10
    },
    
    // number of special attacks available
    special: {
      hero: 0,
      boss: 0
    },
    
    // Boolean for winning
    winner: {
      hero: false,
      boss: false
    }
  };
  
  return {
    getPlayerData: function (playerData){
     // var obj = { name: data.name, email: data.email};
     // console.log(obj);
      setTimeout(function() {
        data.name.hero  = playerData.name;
        data.email.hero = playerData.email;
        data.heal.hero = 1;  ///---------------------------------------------link to sheet!!------------------------------------------------------------------------------------
        data.special.hero = 1; ///---------------------------------------------link to sheet!!------------------------------------------------------------------------------------
        }, 500);
      return playerData;
    },
    
    getRandomArbitrary: function (min, max) {
      return Math.floor(Math.random() * (max - min) + min);
    },
    
    checkIfNoMoveLeft: function (attackingChar, blockingChar, moveType, val) {
      if(data[moveType][attackingChar] <= 0 ){
          return true;
        }else{
          return false;
        }
    
    },

    
    addMove: function (attackingChar, blockingChar, moveType, val) {
      var newMove, error;
      
      var adjustDataValues = function(blockingChar,moveType, val){
        data.hp[blockingChar] -= val;
        data[moveType][blockingChar] - 1;
      
      };
      
      Attack.prototype.damage = function () {
        return data.hp[blockingChar] -= val;
        };
        
      Special.prototype.bigHit = function () { //--------write this out to subtract the amount of special attacks left in the pool
        if(data[moveType][attackingChar] <= 0 ){
          return val = 0;
        } else {
          return data.hp[blockingChar] -= val;
        }
      };
        
      Heal.prototype.healSpell = function () {
        if(data[moveType][attackingChar] <= 0 ){
          return val = 0;
        } else {
          return data.hp[blockingChar] += val;
        }
      };
      
      if( moveType === 'attack') {
        newMove = new Attack(attackingChar, blockingChar, moveType, val);
        newMove.damage();
        
      } else if( moveType === 'special') {
        newMove = new Special(attackingChar, blockingChar, moveType, val);
        newMove.bigHit();
        
      } else if( moveType === 'heal') {
        newMove = new Heal(attackingChar, blockingChar, moveType, val);
        newMove.healSpell();
      }
      // Push move into battle log
      data.battleLog.push(newMove);
      
      //return new element
      return newMove;
    },   
    getNames: function(){
      return data.name;
    },
    
    testing: function() {
      console.log(data);
    }
  };

})();

// --------UI CONTROLLER----------------------------------------------UI CONTROLLER -----------
var UIController = (function() {
  
  var DOMstrings = {
                     playerAttack   : '#nAttack',
                     playerSpecial  : '#nSpecial',
                     playerHeal     : '#nHeal',
                     playerStart    : '#startFight',
                     battleTextCont : '.battle-text',
                     playerHealthBar: '.player-hp',
                     enemyHealthBar : '.enemy-hp'
                   };
  
  
  var startFight = document.getElementById( "startFight" );
  var uiBtns = document.getElementById( "ui-btns" );
  
  return {

    // Add player Avatar and Name
    setPlayerData: function ( nameEmail ) {
      setTimeout ( function ( ) {
      
      var enemyName = "Dwarf Deer";
      var enemyPicURL = "https://arnold.systems/img/d-deer.jpg";
      var enemyIconURL = "https://arnold.systems/img/gunxfishingrod.svg";
      var enemyAvatar = document.getElementById( 'enemyNamed' );
      enemyAvatar.innerHTML = '<div class="w3-container"><img src='+ enemyPicURL +' class="cat-stats title-fight" style="background-image: radial-gradient(circle, white, rgba(137,174,231,1),rgba(0,0,0,0)); position:relative;"><span class="tag w3-tag w3-xlarge" style=" background: transparent ; color:transparent; padding: 0px; border: 0; transform: translate(-100%, 120%) rotate(-4deg); font-size: 26px; text-shadow: 1px 0px 1px #fff, -1px 0px 1px #000, 0px 1px 1px #fff, 0px -1px 1px #000;">' + nameEmail.boss + '<img src=' + enemyIconURL + ' width="25px"></span></div></i>';
   
    
      
      var playerAvatar = document.getElementById( 'playerNamed' );
      playerAvatar.innerHTML = '<div class="w3-container"><img src="https://robohash.org/' + nameEmail.hero + '.png?set=set4&size=100x100" class="cat-stats title-fight" style="background-image: radial-gradient(circle, white, rgba(137,174,231,1),rgba(0,0,0,0)); position:relative;"><span class="tag w3-tag w3-xlarge" style="background: transparent; color: transparent; padding:0px; border: 0; font-size: 26px; transform: translate(-90%, 125%) rotate(3deg); text-shadow: 1px 0px 1px #fff, -1px 0px 1px #000, 0px 1px 1px #000, 0px -1px 1px #fff;">' + nameEmail.hero + ' </i><span style="color: white"><i class="fas fa-paw-claws"></i></span></div>';  
      
      return nameEmail;
      }, 500);
    },
    
    // -- Hides and reveals buttons after startgame
    showHideUI: function() {
      startFight.classList.toggle("w3-hide");
      uiBtns.classList.toggle("w3-hide");
    },
    
    // --  Adds a list item to the battle log
    addListItem: function( obj, names, moveType){
      var html, newHtml, element;
      
      // -- Create HTML String with Placeholder Text
      if( moveType === 'attack') {
        html = '<li class="battle-words bt-a animated bounceIn"><span class="attack-attacker-text">%attackingChar%</span> cleans <span class="attack-blocker-text">%blockingChar%</span> for <span class="attack-value-text">%val%!</span></li>';
      }
        else if ( moveType === 'special') {
        html = '<li class="battle-words bt-s animated flipInY">%attackingChar% winds up for a big attack unleashing %val% of damage on %blockingChar%!</li>';
      }
        else if ( moveType === 'heal') {
        html = '<li class="battle-words bt-h animated jackInTheBox">%attackingChar% smiles as a healspell heals for %val%!</li>';
      }
      
      
      // Replace the Placeholder text with some actual data
      newHtml = html.replace('%attackingChar%', names[obj.attackingChar]);
      newHtml = newHtml.replace('%val%', obj.val);
      newHtml = newHtml.replace('%blockingChar%', names[obj.blockingChar]);
      
      // Insert HTML into the DOM
      element = DOMstrings.battleTextCont;
      document.querySelector(element).insertAdjacentHTML('afterbegin', newHtml);
    },
    getDOMStrings: function() {
      return DOMstrings;
    }
 
  }
// some code



})();

// GLOBAL APP CONTROLLER ------------------------------------------- GLOBAL APP CONTROLLER --------------------------GLOBAL APP CONTROLLER 
var controller = ( function( fightCtrl, UICtrl ) {
  
  var newItem;
  
  var heroChar     = 'hero';
  var bossChar     = 'boss';
  var attackMove   = 'attack';
  var specialMove  = 'special';
  var healMove     = 'heal';
  
  var setupEventListeners = function( ) {
    document.querySelector( DOMstr.playerStart   ).addEventListener( 'click' ,   startClean   ); 
    document.querySelector( DOMstr.playerAttack  ).addEventListener( 'click' ,   cleanAttack  );
    document.querySelector( DOMstr.playerSpecial ).addEventListener( 'click' ,   specialClean );
    document.querySelector( DOMstr.playerHeal    ).addEventListener( 'click' ,   fillBottles  );
  }
  
  var bossMove = function ( ) {
    var dmg =  fightCtrl.getRandomArbitrary( 2 , 4 );
    // ---check win status
    setTimeout ( function ( ) {
      newItem = fightCtrl.addMove( 'boss' , 'hero' , 'attack' , dmg );
      UICtrl.addListItem( newItem , names , 'attack' );    
      fightCtrl.testing( );
    }, 2000 );
  }
  

    
  var DOMstr = UICtrl.getDOMStrings( );   
  
  var names = fightCtrl.getNames( );
    
  var startClean = function( ) {
    
    // hide the startFight Button
    UICtrl.showHideUI( );
    // Display the fight console
  
    // get the player stats
    UICtrl.setPlayerData(names);

    // start the game
    
    
    }
  var cleanAttack = function() { 
    var attackDmg =  fightCtrl.getRandomArbitrary( 2 , 4 );
    newItem = fightCtrl.addMove( heroChar , bossChar , attackMove , attackDmg );
    UICtrl.addListItem( newItem , names , attackMove );
   
    bossMove();
   

  }
  
  var specialClean = function( ) { 
  
    // Change the Damage Range on attacks here ------------------------------ Change the Damage Range on attacks here --!!
    var specialDmg =  fightCtrl.getRandomArbitrary( 2 , 4 );
    
    if( fightCtrl.checkIfNoMoveLeft( heroChar , bossChar , specialMove , specialDmg ) ) {
      launchmodal("You start to use one of the 15 steps that you learned but can't seem to remember..  how did they say Use Both Hands!" );
   
    } else {
    newItem = fightCtrl.addMove( heroChar , bossChar , specialMove , specialDmg );
    }
    UICtrl.addListItem( newItem , names , specialMove );
   
    bossMove();
    
  }
  
  // Heal Function Started by hitting the "heal" button
  var fillBottles = function( ) { 
  
    // Change the Damage Range on attacks here ------Damage Range includes the high and low number------------------------ Change the Damage Range on attacks here -------!!
    var heal =  fightCtrl.getRandomArbitrary( 2 , 4 );
    if( fightCtrl.checkIfNoMoveLeft( heroChar , heroChar , healMove , heal ) ) {
      launchmodal( names[heroChar] + "stops what they are doing and starts to stock their tray before they get back to the office! The clean is still going!" );
   
    } else {
    // add new item to the data 
    newItem = fightCtrl.addMove( heroChar , heroChar , healMove , heal );
   }
    // add item to the UI Battle Text Box
    UICtrl.addListItem( newItem , names , healMove );
    
    // Boss' Turn Same Attack everytime
    bossMove();

  }
  
 
   return {
     init: function(){
       google.script.run.withSuccessHandler(fightCtrl.getPlayerData).employeeUser('object');
       gameRunning = true;
       setupEventListeners();
       console.log("Is Game running? "+ gameRunning);
       //console.log(name);
    }
  }
 

  

})(fightController, UIController);


controller.init();

</script>
 

