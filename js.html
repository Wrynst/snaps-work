<script>
  const date              = new Date().toDateString();
  const tabs              = document.querySelectorAll(".my-tabs .tabs div");
  const sections          = document.querySelectorAll(".my-tabs .tab-content");
  const leaderboardList   = ['leaderboard1','leaderboard2','leaderboard3'];

window.addEventListener( 'load', function() {
  
  google.script.run.withSuccessHandler( displayDataFromArrayOfObj ).makeTables( leaderboardList );

 // google.script.run.withSuccessHandler( displayData3 ).getUserDataFight();                  //
 // google.script.run.withSuccessHandler(displayNav).makeNavButtons();
})
  //Display Individual Player Data from Sheets
  // displayDataHome callback function with data from functions.gs?
  function displayDataHome(data){
  var dataElement = document.getElementById("one");  
  var sheetData = data.obj;
  var name = data.name;
  
  var htmlData = '<div class="w3-container"><ul class="w3-ul w3-small" width="40%"><li><img src="https://robohash.org/' + name + '.png?set=set4&size=100x100" class="cat-stats" style="position:relative;"><span class="tag w3-tag w3-transparent w3-xlarge" style=" color: #911; padding: 1px 10px; border: 0; transform: translate(-70%, 200%) rotate(-5deg); text-shadow: 1px 1px 1px #eaeaea;">'+ name +' </i><i class="fas fa-paw"></i></span><span class="close" onclick="nateclose(this.class)">&times;</span></li>';
  
  for( row in sheetData ){
    if( !sheetData[row].name ){
      continue;
    }else{
      htmlData += '<li class="w3-small">' + sheetData[row].round1 + ' <span class="fa-layers fa-fw"><i style=' + (sheetData[row].type === 'Team' ? "color:#0b7013" : "color:#26396b") + ' class="fas ' + (sheetData[row].event === 'Initiative' ? 'fa-certificate" data-fa-transform="shrink-2">' : 'fa-comment" data-fa-transform="shrink-3">') +  '</i><span class="fa-layers-text fa-inverse w3-vt323" data-fa-transform="down-1" style="font-size:12px;font-weight:900">' + sheetData[row].points + '</span></span><a class="fancy-link w3-tooltip">'+ sheetData[row].title +' <i class="fal fa-info"></i><span class="tool w3-text w3-tag w3-round w3-animate-opacity">' + sheetData[row].why + '</span></a></li>';
    }
  }
  htmlData += '</ul></div>';
  dataElement.innerHTML = htmlData;
}
// Gets Sheets Data from Loading page google script run makeTables and displays it by changing the inner html of the tag with the ID provided by 'name' property of object in the array.
  function displayDataFromArrayOfObj(data){
    data.forEach(function (obj){
      var dataElement = document.getElementById(obj.name);
      dataElement.innerHTML =  obj.table;
    }); 
  }

  function displayData3(data){
  var dataElement = document.getElementById("userFight");
  dataElement.innerHTML =  data;
}

  tabs.forEach(tab => {
    tab.addEventListener("click", e => {
      e.preventDefault();
      removeActiveTab();
      addActiveTab(tab);
    });
  })

  const removeActiveTab = () => {
    tabs.forEach(tab => {
      tab.classList.remove("is-active");
    });
    sections.forEach(section => {
      section.classList.remove("is-active");
    });
  }

  const addActiveTab = tab => {
    tab.classList.add("is-active");
    const href = tab.querySelector("a").getAttribute("href");
    const matchingSection = document.querySelector(href);
    matchingSection.classList.add("is-active");
  }
  
  //
  function myFunction() {
    var x = document.getElementById("Demo");
    if (x.className.indexOf("w3-show") == -1) {  
      x.className += " w3-show";
    } else { 
      x.className = x.className.replace(" w3-show", "");
    }
  }
  
//  document.addEventListener("DOMContentLoaded", function(){
//    google.script.run.withSuccessHandler(generateTable).getSheetObj("leaderboard");
//    
//  });
//  function makeTable(gsValue){
//    var tbody = document.getElementById("table1");
//    tbody.innerHtml = "<h1>hi</h1>";
//  
//  }


 
  
//  
//
//function generateTable(dataArray){
//    console.log(dataArray);
//    var tbody = document.getElementById("table1");
//    
//    dataArray.forEach(function(r){
//      
//      var row = document.createElement("tr");
//        r.forEach(function(c){
//        var col = document.createElement("td");
//        col.textContent = r[c];
//        row.appendChild(col);
//      });
//      tbody.appendChild(row);
//    });
//  }


// Accordian on leaderboard page    
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    /* Toggle between adding and removing the "active" class,
    to highlight the button that controls the panel */
    this.classList.toggle("active");

    /* Toggle between hiding and showing the active panel */
    var panel = this.nextElementSibling;
    if (panel.style.display === "block") {
      panel.style.display = "none";
    } else {
      panel.style.display = "block";
    }
  });
}

// Get the modal 
var modal = document.getElementById("myModal");

// Get the link that opens the modal
//var btn = document.getElementById("Nathan");
//console.log(btn);
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

function nateclose(className){
 
 
  modal.style.display = "none";

   
}


var loading = function (elemId) {
  var e = document.getElementById(elemId);
  e.innerHTML = '<i class="fal animated wobble infinite fa-paw fa-5x"></i>';
}

// when the target is clicked go to sheets and then display when it comes back
function natemodal(name) {
loading('one');
  console.log(name);
  google.script.run.withSuccessHandler(displayDataHome).getSheetObj2headers(name);
  modal.style.display = "block";
}
// X = close the modal
//span.onclick = function() {
//  modal.style.display = "none";
//}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
    
  }
}  
 
 
 function animateCSS(element, animationName, callback) {
    const node = document.querySelector(element)
    node.classList.add('animated', animationName)

    function handleAnimationEnd() {
        node.classList.remove('animated', animationName)
        node.removeEventListener('animationend', handleAnimationEnd)

        if (typeof callback === 'function') callback()
    }

    node.addEventListener('animationend', handleAnimationEnd)
} 
  
//  function move() {
//  var elem = document.getElementById("myBar");   
//  var width = 100;
//  var id = setInterval(frame, 1);
//  function frame() {
//    var hit = Math.random() * 100 ;
//    width -= hit;
//    if (width <= 0) {
//      width = 0;
//      //diplay win loss
//      document.getElementsByClassName("percent").innerHTML = 'You Lost';
//    } else {
// 
//      elem.style.width = width + '%'; 
//      document.getElementsByClassName("percent").innerHTML = width * 1  + '%';
//    }
//  }
//}

</script>
